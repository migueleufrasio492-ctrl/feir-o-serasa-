try{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})["__faroBundleId_gptengineer-app"]="1764098497929708c08cf4c"}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3995],{7622:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FirebaseTokenGenerator=t.BLACKLISTED_CLAIMS=void 0,t.cryptoSignerFromCredential=c,t.createFirebaseTokenGenerator=function(e,t,r){return new u((0,a.useEmulator)()?new o.EmulatorSigner(t):c(e,t,r))};let i=r(59144),n=r(7589),o=r(34139),s=r(10993),a=r(66728);t.BLACKLISTED_CLAIMS=["acr","amr","at_hash","aud","auth_time","azp","cnf","c_hash","exp","iat","iss","jti","nbf","nonce"];class u{signer;constructor(e){this.signer=e}createCustomToken(e,r){let i;if(e.length>128?i="`uid` argument must a uid with less than or equal to 128 characters.":u.isDeveloperClaimsValid_(r)||(i="`developerClaims` argument must be a valid, non-null object containing the developer claims."),i)throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,i);let o={};if(void 0!==r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e)){if(-1!==t.BLACKLISTED_CLAIMS.indexOf(e))throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,`Developer claim "${e}" is reserved and cannot be specified.`);o[e]=r[e]}}return this.signer.getAccountId().then(async t=>{let r=Math.floor(Date.now()/1e3),i={aud:"https://identitytoolkit.googleapis.com/google.identity.identitytoolkit.v1.IdentityToolkit",iat:r,exp:r+3600,iss:t,sub:t,uid:e};return Object.keys(o).length>0&&(i.claims=o),this.signer.sign(i)})}static isDeveloperClaimsValid_(e){return void 0===e||(0,s.isNonNullObject)(e)}}function c(e,t,r){return e instanceof i.ServiceAccountCredential?new o.ServiceAccountSigner(e,t):new o.IAMSigner(e,t,r)}t.FirebaseTokenGenerator=u},10993:(e,t)=>{function r(e){return"object"==typeof e&&!i(e)}function i(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=r,t.isArray=i,t.isNonNullObject=function(e){return r(e)&&null!==e},t.isEmail=function(e){return"string"==typeof e&&/^[^@]+@[^@]+$/.test(e)},t.isURL=function(e){if("string"!=typeof e||/[^a-z0-9:/?#[\]@!$&'()*+,;=.\-_~%]/i.test(e))return!1;try{let t=new URL(e),r=t.protocol,i=t.hostname,n=t.pathname;if("http:"!==r&&"https:"!==r||!i||!/^[a-zA-Z0-9]+[\w-]*([.]?[a-zA-Z0-9]+[\w-]*)*$/.test(i)||n&&"/"!==n&&!/^(\/[\w\-.~!$'()*+,;=:@%]+)*\/?$/.test(n))return!1}catch{return!1}return!0}},20595:(e,t,r)=>{r.d(t,{X:()=>a,k:()=>u});var i=r(72490),n=r(92455),o=r(96078),s=r(52654),a=class extends s.k{#e;#t;#r;#i;#n;#o;#s;constructor(e){super(),this.#s=!1,this.#o=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#r=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=function(e){let t="function"==typeof e.initialData?e.initialData():e.initialData,r=void 0!==t,i=r?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(e){this.options={...this.#o,...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||this.#r.remove(this)}setData(e,t){let r=(0,i.pl)(this.state.data,e,this.options);return this.#a({data:r,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),r}setState(e,t){this.#a({type:"setState",state:e,setStateOptions:t})}cancel(e){let t=this.#n?.promise;return this.#n?.cancel(e),t?t.then(i.lQ).catch(i.lQ):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>!1!==(0,i.Eh)(e.options.enabled,this))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===i.hT||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(e=>"static"===(0,i.d2)(e.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!(0,i.j3)(this.state.dataUpdatedAt,e))}onFocus(){let e=this.observers.find(e=>e.shouldFetchOnWindowFocus());e?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){let e=this.observers.find(e=>e.shouldFetchOnReconnect());e?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(this.#n&&(this.#s?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#a({type:"invalidate"})}async fetch(e,t){if("idle"!==this.state.fetchStatus&&this.#n?.status()!=="rejected"){if(void 0!==this.state.data&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(e&&this.setOptions(e),!this.options.queryFn){let e=this.observers.find(e=>e.options.queryFn);e&&this.setOptions(e.options)}let r=new AbortController,n=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(this.#s=!0,r.signal)})},s=()=>{let e=(0,i.ZM)(this.options,t),r=(()=>{let e={client:this.#i,queryKey:this.queryKey,meta:this.meta};return n(e),e})();return(this.#s=!1,this.options.persister)?this.options.persister(e,r,this):e(r)},a=(()=>{let e={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:s};return n(e),e})();this.options.behavior?.onFetch(a,this),this.#t=this.state,("idle"===this.state.fetchStatus||this.state.fetchMeta!==a.fetchOptions?.meta)&&this.#a({type:"fetch",meta:a.fetchOptions?.meta}),this.#n=(0,o.II)({initialPromise:t?.initialPromise,fn:a.fetchFn,abort:r.abort.bind(r),onFail:(e,t)=>{this.#a({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#a({type:"pause"})},onContinue:()=>{this.#a({type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0});try{let e=await this.#n.start();if(void 0===e)throw Error(`${this.queryHash} data is undefined`);return this.setData(e),this.#r.config.onSuccess?.(e,this),this.#r.config.onSettled?.(e,this.state.error,this),e}catch(e){if(e instanceof o.cc){if(e.silent)return this.#n.promise;else if(e.revert){if(this.setState({...this.#t,fetchStatus:"idle"}),void 0===this.state.data)throw e;return this.state.data}}throw this.#a({type:"error",error:e}),this.#r.config.onError?.(e,this),this.#r.config.onSettled?.(this.state.data,e,this),e}finally{this.scheduleGc()}}#a(e){let t=t=>{switch(e.type){case"failed":return{...t,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...t,fetchStatus:"paused"};case"continue":return{...t,fetchStatus:"fetching"};case"fetch":return{...t,...u(t.data,this.options),fetchMeta:e.meta??null};case"success":let r={...t,data:e.data,dataUpdateCount:t.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?r:void 0,r;case"error":let i=e.error;return{...t,error:i,errorUpdateCount:t.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:t.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...t,isInvalidated:!0};case"setState":return{...t,...e.state}}};this.state=t(this.state),n.jG.batch(()=>{this.observers.forEach(e=>{e.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:e})})}};function u(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:(0,o.v_)(t.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}},24790:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sign=a,t.signBlob=l;let i=r(70463),n=r(7589),o=r(35886),s=r(60430);async function a({payload:e,privateKey:t,keyId:r}){let o;try{o=await (0,i.importPKCS8)(t,s.ALGORITHM_RS256)}catch(e){throw n.AuthError.fromError(e,n.AuthErrorCode.INVALID_ARGUMENT,"It looks like the value provided for `serviceAccount.privateKey` is incorrectly formatted. Please double-check if private key has correct format. See https://github.com/awinogrodzki/next-firebase-auth-edge/issues/246#issuecomment-2321559620 for details")}return new i.SignJWT(e).setProtectedHeader({alg:s.ALGORITHM_RS256,kid:r}).sign(o)}function u(e){return e.replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}function c(e){let t=JSON.stringify(e);return u(i.base64url.encode(t))}async function l({payload:e,serviceAccountId:t,accessToken:r}){let n=`https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/${t}:signBlob`,a={alg:s.ALGORITHM_RS256,typ:"JWT"},l=`${c(a)}.${c(e)}`,d={method:"POST",headers:{Authorization:`Bearer ${r}`},body:JSON.stringify({payload:i.base64url.encode(l)})},h=await (0,o.fetchAny)(n,d),f=await h.blob(),{signedBlob:p}=JSON.parse(await f.text());return`${l}.${u(p)}`}},33570:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthRequestHandler=t.AbstractAuthRequestHandler=t.FIREBASE_AUTH_LIST_USERS_INFO=t.FIREBASE_AUTH_SIGN_UP_NEW_USER=t.FIREBASE_AUTH_SET_ACCOUNT_INFO=t.FIREBASE_AUTH_DELETE_ACCOUNT=t.FIREBASE_AUTH_GET_ACCOUNT_INFO=t.FIREBASE_AUTH_CREATE_SESSION_COOKIE=t.ApiSettings=void 0,t.getSdkVersion=c,t.convertMultiFactorInfoToServerFormat=p;let i=r(59144),n=r(7589),o=r(66728),s=r(35886),a=r(10993);class u{endpoint;httpMethod;constructor(e,t="POST"){this.endpoint=e,this.httpMethod=t}getEndpoint(){return this.endpoint}getHttpMethod(){return this.httpMethod}}function c(){return"11.2.0"}t.ApiSettings=u;let l={"X-Client-Version":`Node/Admin/${c()}`,Accept:"application/json","Content-Type":"application/json"};class d{version;credential;urlFormat;constructor(e="v1",t){this.version=e,this.credential=t,(0,o.useEmulator)()?this.urlFormat=(0,s.formatString)("http://{host}/identitytoolkit.googleapis.com/{version}/projects/{projectId}{api}",{host:(0,o.emulatorHost)()}):this.urlFormat="https://identitytoolkit.googleapis.com/{version}/projects/{projectId}{api}"}async getUrl(e,t){let r={version:this.version,projectId:await this.credential.getProjectId(),api:e||""},i=(0,s.formatString)(this.urlFormat,r);return(0,s.formatString)(i,t||{})}}t.FIREBASE_AUTH_CREATE_SESSION_COOKIE=new u(":createSessionCookie","POST"),t.FIREBASE_AUTH_GET_ACCOUNT_INFO=new u("/accounts:lookup","POST"),t.FIREBASE_AUTH_DELETE_ACCOUNT=new u("/accounts:delete","POST"),t.FIREBASE_AUTH_SET_ACCOUNT_INFO=new u("/accounts:update","POST"),t.FIREBASE_AUTH_SIGN_UP_NEW_USER=new u("/accounts","POST"),t.FIREBASE_AUTH_LIST_USERS_INFO=new u("/accounts:batchGet","GET");class h{options;authUrlBuilder;getToken;static getErrorCode(e){return(0,a.isNonNullObject)(e)&&e.error&&e.error.message||null}constructor(e,t={}){this.options=t,this.getToken=(0,o.useEmulator)()?()=>Promise.resolve({accessToken:"owner",expirationTime:1/0}):(0,i.getFirebaseAdminTokenProvider)(e).getToken}prepareRequest(e){return this.options.tenantId?{...e,tenantId:this.options.tenantId}:e}getAccountInfoByUid(e){return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_GET_ACCOUNT_INFO,{localId:[e]})}deleteAccount(e){return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_DELETE_ACCOUNT,{localId:e})}getAccountInfoByEmail(e){return(0,a.isEmail)(e)?this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_GET_ACCOUNT_INFO,{email:[e]}):Promise.reject(new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,"Invalid e-mail address"))}createNewAccount(e){let r={...e};if(void 0!==r.photoURL&&(r.photoUrl=r.photoURL,delete r.photoURL),void 0!==r.uid&&(r.localId=r.uid,delete r.uid),r.multiFactor){if(Array.isArray(r.multiFactor.enrolledFactors)&&r.multiFactor.enrolledFactors.length>0){let e=[];try{r.multiFactor.enrolledFactors.forEach(t=>{if("enrollmentTime"in t)throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,'"enrollmentTime" is not supported when adding second factors via "createUser()"');if("uid"in t)throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,'"uid" is not supported when adding second factors via "createUser()"');e.push(p(t))})}catch(e){return Promise.reject(e)}r.mfaInfo=e}delete r.multiFactor}return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_SIGN_UP_NEW_USER,r).then(e=>e.localId)}createSessionCookie(e,r){return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_CREATE_SESSION_COOKIE,{idToken:e,validDuration:r/1e3}).then(e=>e.sessionCookie)}updateExistingAccount(e,r){let i={...r,deleteAttribute:[],localId:e},n={displayName:"DISPLAY_NAME",photoURL:"PHOTO_URL"};for(let e in i.deleteAttribute=[],n)null===i[e]&&(i.deleteAttribute.push(n[e]),delete i[e]);if(0===i.deleteAttribute.length&&delete i.deleteAttribute,null===i.phoneNumber&&(i.deleteProvider?i.deleteProvider.push("phone"):i.deleteProvider=["phone"],delete i.phoneNumber),void 0!==i.providerToLink&&(i.linkProviderUserInfo={...i.providerToLink},delete i.providerToLink,i.linkProviderUserInfo.rawId=i.linkProviderUserInfo.uid,delete i.linkProviderUserInfo.uid),void 0!==i.providersToUnlink&&(Array.isArray(i.deleteProvider)||(i.deleteProvider=[]),i.deleteProvider=i.deleteProvider.concat(i.providersToUnlink),delete i.providersToUnlink),void 0!==i.photoURL&&(i.photoUrl=i.photoURL,delete i.photoURL),void 0!==i.disabled&&(i.disableUser=i.disabled,delete i.disabled),i.multiFactor){if(null===i.multiFactor.enrolledFactors)i.mfa={};else if(Array.isArray(i.multiFactor.enrolledFactors)){i.mfa={enrollments:[]};try{i.multiFactor.enrolledFactors.forEach(e=>{i.mfa.enrollments.push(p(e))})}catch(e){return Promise.reject(e)}0===i.mfa.enrollments.length&&delete i.mfa.enrollments}delete i.multiFactor}return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_SET_ACCOUNT_INFO,i).then(e=>e.localId)}setCustomUserClaims(e,r){null===r&&(r={});let i={localId:e,customAttributes:JSON.stringify(r)};return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_SET_ACCOUNT_INFO,i).then(e=>e.localId)}listUsers(e,r){return this.invokeRequestHandler(this.getAuthUrlBuilder(),t.FIREBASE_AUTH_LIST_USERS_INFO,{nextPageToken:e,maxResults:r})}getSearchParams(e){let t=new URLSearchParams;for(let r in e)e[r]&&t.append(r,e[r]);return t}decorateUrlWithParams(e,t){let r=this.getSearchParams(t).toString();return r?`${e}?${r}`:e}async invokeRequestHandler(e,t,r,i){let o=await e.getUrl(t.getEndpoint(),i),s=await this.getToken(),a={method:t.getHttpMethod(),headers:{...l,Authorization:`Bearer ${s.accessToken}`}};r&&!["GET","HEAD"].includes(t.getHttpMethod())&&(a.body=JSON.stringify(this.prepareRequest(r))),r&&["GET","HEAD"].includes(t.getHttpMethod())&&(o=this.decorateUrlWithParams(o,this.prepareRequest(r)));let u=await fetch(o,a);if(!u.ok){let e=await u.json(),t=h.getErrorCode(e);if(!t)throw new n.AuthError(n.AuthErrorCode.INTERNAL_ERROR,`Error returned from server: ${JSON.stringify(e)}.`);throw new n.AuthError(n.AuthErrorCode.INTERNAL_ERROR,`Error returned from server: ${JSON.stringify(e)}. Code: ${t}`)}return await u.json()}getAuthUrlBuilder(){return this.authUrlBuilder||(this.authUrlBuilder=this.newAuthUrlBuilder()),this.authUrlBuilder}}t.AbstractAuthRequestHandler=h;class f extends h{credential;authResourceUrlBuilder;constructor(e,t){super(e,t),this.credential=e,this.authResourceUrlBuilder=new d("v2",e)}newAuthUrlBuilder(){return new d("v1",this.credential)}}function p(e){let t;if(void 0!==e.enrollmentTime)if(function(e){try{return!!e&&new Date(e).toUTCString()===e}catch{return!1}}(e.enrollmentTime))t=new Date(e.enrollmentTime).toISOString();else throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,`The second factor "enrollmentTime" for "${e.uid}" must be a valid UTC date string.`);if("phone"===e.factorId){let r={mfaEnrollmentId:e.uid,displayName:e.displayName,phoneInfo:e.phoneNumber,enrolledAt:t};for(let e in r)void 0===r[e]&&delete r[e];return r}throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,`Unsupported second factor "${JSON.stringify(e)}" provided.`)}t.AuthRequestHandler=f},34139:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IAMSigner=t.ServiceAccountSigner=t.EmulatorSigner=void 0,t.createEmulatorToken=a;let i=r(70463),n=r(35886),o=r(24790),s=r(60430);function a(e){return`${i.base64url.encode(JSON.stringify({alg:"none",typ:"JWT"}))}.${i.base64url.encode(JSON.stringify(e))}.${i.base64url.encode("")}`}class u{tenantId;constructor(e){this.tenantId=e}async sign(e){return this.tenantId&&(e.tenant_id=this.tenantId),a(e)}getAccountId(){return Promise.resolve("firebase-auth-emulator@example.com")}}t.EmulatorSigner=u;class c{credential;tenantId;constructor(e,t){this.credential=e,this.tenantId=t}async sign(e){return this.tenantId&&(e.tenant_id=this.tenantId),(0,o.sign)({payload:e,privateKey:this.credential.privateKey})}getAccountId(){return Promise.resolve(this.credential.clientEmail)}}t.ServiceAccountSigner=c;class l{algorithm=s.ALGORITHM_RS256;credential;tenantId;serviceAccountId;constructor(e,t,r){this.credential=e,this.tenantId=t,this.serviceAccountId=r}async sign(e){this.tenantId&&(e.tenant_id=this.tenantId);let t=await this.getAccountId(),r=await this.credential.getAccessToken();return(0,o.signBlob)({accessToken:r.accessToken,serviceAccountId:t,payload:e})}async getAccountId(){if(this.serviceAccountId)return this.serviceAccountId;let e=await this.credential.getAccessToken(),t={method:"GET",headers:{"Metadata-Flavor":"Google",Authorization:`Bearer ${e.accessToken}`}};return this.serviceAccountId=await (0,n.fetchText)("http://metadata/computeMetadata/v1/instance/service-accounts/default/email",t)}}t.IAMSigner=l},35886:(e,t)=>{async function r(e){let t=await e.json();if(!t)return"Missing error payload";let r="string"==typeof t.error?t.error:t.error?.message??"Missing error payload";return t.error_description&&(r+=" ("+t.error_description+")"),r}async function i(e,t){return(await o(e,t)).json()}async function n(e,t){return(await o(e,t)).text()}async function o(e,t){let i=await fetch(e,t);if(!i.ok)throw Error(await r(i));return i}function s(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let i=e;i[r]=s(i[r],i[r])}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.formatString=function(e,t){let r=e;return Object.keys(t||{}).forEach(e=>{r=r.replace(RegExp("{"+e+"}","g"),t[e])}),r},t.fetchJson=i,t.fetchText=n,t.fetchAny=o,t.mapJwtPayloadToDecodedIdToken=function(e){return e.uid=e.sub,e},t.addReadonlyGetter=function(e,t,r){Object.defineProperty(e,t,{value:r,writable:!1,enumerable:!0})},t.deepCopy=function(e){return s(void 0,e)},t.deepExtend=s,t.toUint8Array=function(e){return a.encode(e)};let a=new TextEncoder},38424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.filterStandardClaims=t.STANDARD_CLAIMS=void 0,t.STANDARD_CLAIMS=["aud","auth_time","email","email_verified","exp","firebase","source_sign_in_provider","iat","iss","name","phone_number","picture","sub","uid","user_id"],t.filterStandardClaims=(e={})=>{let r={};return Object.keys(e).forEach(i=>{t.STANDARD_CLAIMS.includes(i)||(r[i]=e[i])}),r}},39432:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getApplicationDefault=void 0;let i=r(59144);t.getApplicationDefault=()=>new i.ComputeEngineCredential},41757:(e,t,r)=>{r.d(t,{E:()=>p});var i=r(72490),n=r(20595),o=r(92455),s=r(6144),a=class extends s.Q{constructor(e={}){super(),this.config=e,this.#u=new Map}#u;build(e,t,r){let o=t.queryKey,s=t.queryHash??(0,i.F$)(o,t),a=this.get(s);return a||(a=new n.X({client:e,queryKey:o,queryHash:s,options:e.defaultQueryOptions(t),state:r,defaultOptions:e.getQueryDefaults(o)}),this.add(a)),a}add(e){this.#u.has(e.queryHash)||(this.#u.set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){let t=this.#u.get(e.queryHash);t&&(e.destroy(),t===e&&this.#u.delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){o.jG.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return this.#u.get(e)}getAll(){return[...this.#u.values()]}find(e){let t={exact:!0,...e};return this.getAll().find(e=>(0,i.MK)(t,e))}findAll(e={}){let t=this.getAll();return Object.keys(e).length>0?t.filter(t=>(0,i.MK)(e,t)):t}notify(e){o.jG.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){o.jG.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){o.jG.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},u=r(55430),c=class extends s.Q{constructor(e={}){super(),this.config=e,this.#c=new Set,this.#l=new Map,this.#d=0}#c;#l;#d;build(e,t,r){let i=new u.s({mutationCache:this,mutationId:++this.#d,options:e.defaultMutationOptions(t),state:r});return this.add(i),i}add(e){this.#c.add(e);let t=l(e);if("string"==typeof t){let r=this.#l.get(t);r?r.push(e):this.#l.set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(this.#c.delete(e)){let t=l(e);if("string"==typeof t){let r=this.#l.get(t);if(r)if(r.length>1){let t=r.indexOf(e);-1!==t&&r.splice(t,1)}else r[0]===e&&this.#l.delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){let t=l(e);if("string"!=typeof t)return!0;{let r=this.#l.get(t),i=r?.find(e=>"pending"===e.state.status);return!i||i===e}}runNext(e){let t=l(e);if("string"!=typeof t)return Promise.resolve();{let r=this.#l.get(t)?.find(t=>t!==e&&t.state.isPaused);return r?.continue()??Promise.resolve()}}clear(){o.jG.batch(()=>{this.#c.forEach(e=>{this.notify({type:"removed",mutation:e})}),this.#c.clear(),this.#l.clear()})}getAll(){return Array.from(this.#c)}find(e){let t={exact:!0,...e};return this.getAll().find(e=>(0,i.nJ)(t,e))}findAll(e={}){return this.getAll().filter(t=>(0,i.nJ)(e,t))}notify(e){o.jG.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){let e=this.getAll().filter(e=>e.state.isPaused);return o.jG.batch(()=>Promise.all(e.map(e=>e.continue().catch(i.lQ))))}};function l(e){return e.options.scope?.id}var d=r(13498),h=r(51369),f=r(58197),p=class{#h;#f;#o;#p;#y;#m;#g;#v;constructor(e={}){this.#h=e.queryCache||new a,this.#f=e.mutationCache||new c,this.#o=e.defaultOptions||{},this.#p=new Map,this.#y=new Map,this.#m=0}mount(){this.#m++,1===this.#m&&(this.#g=d.m.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#h.onFocus())}),this.#v=h.t.subscribe(async e=>{e&&(await this.resumePausedMutations(),this.#h.onOnline())}))}unmount(){this.#m--,0===this.#m&&(this.#g?.(),this.#g=void 0,this.#v?.(),this.#v=void 0)}isFetching(e){return this.#h.findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return this.#f.findAll({...e,status:"pending"}).length}getQueryData(e){let t=this.defaultQueryOptions({queryKey:e});return this.#h.get(t.queryHash)?.state.data}ensureQueryData(e){let t=this.defaultQueryOptions(e),r=this.#h.build(this,t),n=r.state.data;return void 0===n?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime((0,i.d2)(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return this.#h.findAll(e).map(({queryKey:e,state:t})=>[e,t.data])}setQueryData(e,t,r){let n=this.defaultQueryOptions({queryKey:e}),o=this.#h.get(n.queryHash),s=o?.state.data,a=(0,i.Zw)(t,s);if(void 0!==a)return this.#h.build(this,n).setData(a,{...r,manual:!0})}setQueriesData(e,t,r){return o.jG.batch(()=>this.#h.findAll(e).map(({queryKey:e})=>[e,this.setQueryData(e,t,r)]))}getQueryState(e){let t=this.defaultQueryOptions({queryKey:e});return this.#h.get(t.queryHash)?.state}removeQueries(e){let t=this.#h;o.jG.batch(()=>{t.findAll(e).forEach(e=>{t.remove(e)})})}resetQueries(e,t){let r=this.#h;return o.jG.batch(()=>(r.findAll(e).forEach(e=>{e.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){let r={revert:!0,...t};return Promise.all(o.jG.batch(()=>this.#h.findAll(e).map(e=>e.cancel(r)))).then(i.lQ).catch(i.lQ)}invalidateQueries(e,t={}){return o.jG.batch(()=>(this.#h.findAll(e).forEach(e=>{e.invalidate()}),e?.refetchType==="none")?Promise.resolve():this.refetchQueries({...e,type:e?.refetchType??e?.type??"active"},t))}refetchQueries(e,t={}){let r={...t,cancelRefetch:t.cancelRefetch??!0};return Promise.all(o.jG.batch(()=>this.#h.findAll(e).filter(e=>!e.isDisabled()&&!e.isStatic()).map(e=>{let t=e.fetch(void 0,r);return r.throwOnError||(t=t.catch(i.lQ)),"paused"===e.state.fetchStatus?Promise.resolve():t}))).then(i.lQ)}fetchQuery(e){let t=this.defaultQueryOptions(e);void 0===t.retry&&(t.retry=!1);let r=this.#h.build(this,t);return r.isStaleByTime((0,i.d2)(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(i.lQ).catch(i.lQ)}fetchInfiniteQuery(e){return e.behavior=(0,f.PL)(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(i.lQ).catch(i.lQ)}ensureInfiniteQueryData(e){return e.behavior=(0,f.PL)(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return h.t.isOnline()?this.#f.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#h}getMutationCache(){return this.#f}getDefaultOptions(){return this.#o}setDefaultOptions(e){this.#o=e}setQueryDefaults(e,t){this.#p.set((0,i.EN)(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){let t=[...this.#p.values()],r={};return t.forEach(t=>{(0,i.Cp)(e,t.queryKey)&&Object.assign(r,t.defaultOptions)}),r}setMutationDefaults(e,t){this.#y.set((0,i.EN)(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){let t=[...this.#y.values()],r={};return t.forEach(t=>{(0,i.Cp)(e,t.mutationKey)&&Object.assign(r,t.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;let t={...this.#o.queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=(0,i.F$)(t.queryKey,t)),void 0===t.refetchOnReconnect&&(t.refetchOnReconnect="always"!==t.networkMode),void 0===t.throwOnError&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===i.hT&&(t.enabled=!1),t}defaultMutationOptions(e){return e?._defaulted?e:{...this.#o.mutations,...e?.mutationKey&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){this.#h.clear(),this.#f.clear()}}},50318:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.enableDebugMode=function(){r=!0},t.debug=function(e,t){if(r&&(console.log("â“˜ next-firebase-auth-edge:",e),t))for(let e in t)t[e]&&console.log("	",`${e}:`,t[e])};let r=!1},58197:(e,t,r)=>{r.d(t,{PL:()=>n,RQ:()=>u,rB:()=>a});var i=r(72490);function n(e){return{onFetch:(t,r)=>{let n=t.options,a=t.fetchOptions?.meta?.fetchMore?.direction,u=t.state.data?.pages||[],c=t.state.data?.pageParams||[],l={pages:[],pageParams:[]},d=0,h=async()=>{let r=!1,h=(0,i.ZM)(t.options,t.fetchOptions),f=async(e,n,o)=>{if(r)return Promise.reject();if(null==n&&e.pages.length)return Promise.resolve(e);let s=(()=>{let e={client:t.client,queryKey:t.queryKey,pageParam:n,direction:o?"backward":"forward",meta:t.options.meta};return Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(t.signal.aborted?r=!0:t.signal.addEventListener("abort",()=>{r=!0}),t.signal)}),e})(),a=await h(s),{maxPages:u}=t.options,c=o?i.ZZ:i.y9;return{pages:c(e.pages,a,u),pageParams:c(e.pageParams,n,u)}};if(a&&u.length){let e="backward"===a,t={pages:u,pageParams:c},r=(e?s:o)(n,t);l=await f(t,r,e)}else{let t=e??u.length;do{let e=0===d?c[0]??n.initialPageParam:o(n,l);if(d>0&&null==e)break;l=await f(l,e),d++}while(d<t)}return l};t.options.persister?t.fetchFn=()=>t.options.persister?.(h,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r):t.fetchFn=h}}}function o(e,{pages:t,pageParams:r}){let i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,r[i],r):void 0}function s(e,{pages:t,pageParams:r}){return t.length>0?e.getPreviousPageParam?.(t[0],t,r[0],r):void 0}function a(e,t){return!!t&&null!=o(e,t)}function u(e,t){return!!t&&!!e.getPreviousPageParam&&null!=s(e,t)}},59070:(e,t,r)=>{r.d(t,{i:()=>a}),new TextEncoder;let i=new TextDecoder;class n extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class o extends n{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class s extends n{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}function a(e){let t,r;if("string"!=typeof e)throw new o("JWTs must use Compact JWS serialization, JWT must be a string");let{1:n,length:s}=e.split(".");if(5===s)throw new o("Only JWTs using Compact JWS serialization can be decoded");if(3!==s)throw new o("Invalid JWT");if(!n)throw new o("JWTs must contain a payload");try{t=function(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:i.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=i.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{var r=t;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(r);let e=atob(r),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}(n)}catch{throw new o("Failed to base64url decode the payload")}try{r=JSON.parse(i.decode(t))}catch{throw new o("Failed to parse the decoded payload as JSON")}if(!(e=>{var t;if("object"!=typeof(t=e)||null===t||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r})(r))throw new o("Invalid JWT Claims Set");return r}},59144:(e,t,r)=>{var i=r(40074);Object.defineProperty(t,"__esModule",{value:!0}),t.getFirebaseAdminTokenProvider=t.ComputeEngineCredential=t.ServiceAccountCredential=void 0,t.getExplicitProjectId=function(){let e=i.env.GOOGLE_CLOUD_PROJECT||i.env.GCLOUD_PROJECT;return e||null};let n=r(24790),o=r(35886),s=new Map;class a{projectId;privateKey;clientEmail;constructor(e){this.projectId=e.projectId,this.privateKey=e.privateKey,this.clientEmail=e.clientEmail}async fetchAccessToken(e){let t=await this.createJwt();return u(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:`Bearer ${t}`,Accept:"application/json"},body:"grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Ajwt-bearer&assertion="+t})}getProjectId(){return Promise.resolve(this.projectId)}getServiceAccountEmail(){return Promise.resolve(this.clientEmail)}async fetchAndCacheAccessToken(e){let t=await this.fetchAccessToken(e);return s.set(e.toString(),t),t}async getAccessToken(e){let t="https://accounts.google.com/o/oauth2/token";if(e)return this.fetchAndCacheAccessToken(t);let r=s.get(t);return!r||r.expirationTime-Date.now()<=3e5?this.fetchAndCacheAccessToken(t):r}async createJwt(){let e=Math.floor(Date.now()/1e3),t={aud:"https://accounts.google.com/o/oauth2/token",iat:e,exp:e+3600,iss:this.clientEmail,sub:this.clientEmail,scope:"https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/firebase.database https://www.googleapis.com/auth/firebase.messaging https://www.googleapis.com/auth/identitytoolkit https://www.googleapis.com/auth/userinfo.email"};return(0,n.sign)({payload:t,privateKey:this.privateKey})}}async function u(e,t){let r=await (0,o.fetchJson)(e,t);if(!r.access_token||!r.expires_in)throw Error(`Unexpected response while fetching access token: ${JSON.stringify(r)}`);return{accessToken:r.access_token,expirationTime:Date.now()+1e3*r.expires_in}}t.ServiceAccountCredential=a;let c="metadata.google.internal";async function l(e,t){let r=await (0,o.fetchText)(e,t);if(!r)throw Error("Unexpected response while fetching id token: response.text is undefined");return r}class d{projectId;accountId;cachedToken;constructor(){}async getAccessToken(e=!1){let t=`http://${c}/computeMetadata/v1/instance/service-accounts/default/token`,r=this.buildRequest();return this.cachedToken&&!e&&this.cachedToken.expirationTime-Date.now()<=3e5?this.cachedToken:this.cachedToken=await u(t,r)}getIDToken(e){return l(`http://${c}/computeMetadata/v1/instance/service-accounts/default/identity?audience=${e}`,this.buildRequest())}async getProjectId(){if(this.projectId)return Promise.resolve(this.projectId);let e=`http://${c}/computeMetadata/v1/project/project-id`,t=this.buildRequest();try{let r=await (0,o.fetchText)(e,t);return this.projectId=r,this.projectId}catch(e){throw Error(`Failed to determine project ID: ${e}`)}}async getServiceAccountEmail(){if(this.accountId)return Promise.resolve(this.accountId);let e=`http://${c}/computeMetadata/v1/instance/service-accounts/default/email`,t=this.buildRequest();try{let r=await (0,o.fetchText)(e,t);return this.accountId=r,this.accountId}catch(e){throw Error(`Failed to determine service account email: ${e}`)}}buildRequest(){return{method:"GET",headers:{"Metadata-Flavor":"Google"}}}}t.ComputeEngineCredential=d,t.getFirebaseAdminTokenProvider=e=>({getToken:async function(t=!1){return e.getAccessToken(t)}})},60430:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ALGORITHM_RS256=void 0,t.getPublicCryptoKey=a,t.verify=u;let i=r(70463),n=r(66728);t.ALGORITHM_RS256="RS256";let o=new Map;async function s(e){return e.startsWith("-----BEGIN CERTIFICATE-----")?(0,i.importX509)(e,t.ALGORITHM_RS256):(0,i.importSPKI)(e,t.ALGORITHM_RS256)}async function a(e){let t=o.get(e);if(t)return t;let r=await s(e);return o.set(e,r),r}async function u(e,t,r){let o=r.currentDate??new Date,s=o.getTime()/1e3,a=(0,i.decodeJwt)(e);if(!(0,n.useEmulator)()){let{payload:r}=await (0,i.jwtVerify)(e,await t(),{currentDate:o});return r}if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new i.errors.JWTInvalid("invalid nbf value");if(a.nbf>s)throw new i.errors.JWTExpired("jwt not active: "+new Date(1e3*a.nbf).toISOString(),a)}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new i.errors.JWTInvalid("invalid exp value");if(s>=a.exp)throw new i.errors.JWTExpired("token expired: "+new Date(1e3*a.exp).toISOString(),a)}return a}},60746:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},61535:function(e,t,r){var i=r(40074),n=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);(!n||("get"in n?!t.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.customTokenToIdAndRefreshTokens=m,t.createAnonymousAccount=g,t.isUserNotFoundError=function(e){return e?.code===d.AuthErrorCode.USER_NOT_FOUND},t.isInvalidCredentialError=function(e){return e?.code===d.AuthErrorCode.INVALID_CREDENTIAL},t.handleExpiredToken=E,t.getFirebaseAuth=function(e,t,r){return e.privateKey&&e.projectId&&e.clientEmail?w({credential:new c.ServiceAccountCredential(e),apiKey:t,tenantId:r}):w({credential:e.serviceAccount?new c.ServiceAccountCredential(e.serviceAccount):(0,l.getApplicationDefault)(),apiKey:e.apiKey,tenantId:e.tenantId,serviceAccountId:e.serviceAccountId,enableCustomToken:e.enableCustomToken})};let s=r(50318),a=r(33570),u=r(38424),c=r(59144),l=r(39432),d=r(7589),h=r(66728),f=r(7622),p=r(62067),y=r(77740);async function m(e,t,r){let n={"Content-Type":"application/json",...r.referer?{Referer:r.referer}:{}},o={token:e,returnSecureToken:!0};r.appCheckToken&&(n["X-Firebase-AppCheck"]=r.appCheckToken),r.tenantId&&(o.tenantId=r.tenantId);let s=await fetch((e=>{if((0,h.useEmulator)()&&i.env.FIREBASE_AUTH_EMULATOR_HOST){let t="http://";return i.env.FIREBASE_AUTH_EMULATOR_HOST.startsWith("http://")&&(t=""),`${t}${i.env.FIREBASE_AUTH_EMULATOR_HOST}/identitytoolkit.googleapis.com/v1/accounts:signInWithCustomToken?key=${e}`}return`https://identitytoolkit.googleapis.com/v1/accounts:signInWithCustomToken?key=${e}`})(t),{method:"POST",headers:n,body:JSON.stringify(o)}),a=await s.json();if(!s.ok)throw Error(`Problem getting a refresh token: ${JSON.stringify(a)}`);return{idToken:a.idToken,refreshToken:a.refreshToken}}async function g(e,t={}){let r={"Content-Type":"application/json",...t.referer?{Referer:t.referer}:{}},i={returnSecureToken:!0};t.appCheckToken&&(r["X-Firebase-AppCheck"]=t.appCheckToken),t.tenantId&&(i.tenantId=t.tenantId);let n=await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=${e}`,{method:"POST",headers:r,body:JSON.stringify(i)});return await n.json()}o(r(7589),t),o(r(60746),t);let v=async(e,t)=>{let r=await fetch((e=>{if((0,h.useEmulator)()&&i.env.FIREBASE_AUTH_EMULATOR_HOST){let t="http://";return i.env.FIREBASE_AUTH_EMULATOR_HOST.startsWith("http://")&&(t=""),`${t}${i.env.FIREBASE_AUTH_EMULATOR_HOST}/securetoken.googleapis.com/v1/token?key=${e}`}return`https://securetoken.googleapis.com/v1/token?key=${e}`})(t.apiKey),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",...t.referer?{Referer:t.referer}:{}},body:`grant_type=refresh_token&refresh_token=${e}`});if(!r.ok){let e=await r.json(),t=`Error fetching access token: ${JSON.stringify(e.error)} ${e.error_description?`(${e.error_description})`:""}`;if(e?.error?.code===400&&e?.error?.message==="USER_NOT_FOUND")throw new d.AuthError(d.AuthErrorCode.USER_NOT_FOUND);throw new d.AuthError(d.AuthErrorCode.INVALID_CREDENTIAL,t)}let n=await r.json();return{idToken:n.id_token,refreshToken:n.refresh_token}};async function A(e,t,r){try{return await t(e)}catch(e){return r(e)}}async function E(e,t,r,i){try{return await e()}catch(e){switch(e?.code){case d.AuthErrorCode.NO_MATCHING_KID:if(i)return A(e,async e=>{let r=await t(e);return(0,s.debug)("experimental_refresh_on_expired_kid: Successfully refreshed token after kid has expired"),r},e=>((0,s.debug)("experimental_refresh_on_expired_kid: Error when trying to refresh token after kid has expired",{message:e?.message,stack:e?.stack}),r(e)));return r(e);case d.AuthErrorCode.TOKEN_EXPIRED:return A(e,t,r);default:return r(e)}}}let T={referer:""};function w(e){let t=e.credential??(0,l.getApplicationDefault)(),r=e.tenantId,i=new a.AuthRequestHandler(t,{tenantId:r}),n=(0,f.createFirebaseTokenGenerator)(t,r),o=async(t,r={})=>{let{idToken:i,refreshToken:n}=await v(t,{apiKey:e.apiKey,referer:r.referer}),o=await w(i,{referer:r.referer});if(!r.enableCustomToken)return{decodedIdToken:o,idToken:i,refreshToken:n};let s=await I(o.uid,{email_verified:o.email_verified,source_sign_in_provider:o.firebase.sign_in_provider});return{decodedIdToken:o,idToken:i,refreshToken:n,customToken:s}};async function c(e,t){return r&&await w(e),i.createSessionCookie(e,t)}async function h(e){return i.getAccountInfoByUid(e).then(e=>e.users?.length?new y.UserRecord(e.users[0]):null)}async function A(e){return h(e.sub).then(t=>{if(!t)throw new d.AuthError(d.AuthErrorCode.USER_NOT_FOUND);if(t.disabled)throw new d.AuthError(d.AuthErrorCode.USER_DISABLED);if(t.tokensValidAfterTime&&1e3*e.auth_time<new Date(t.tokensValidAfterTime).getTime())throw new d.AuthError(d.AuthErrorCode.TOKEN_REVOKED);return e})}async function w(e,i=T){let n=await t.getProjectId(),o=(0,p.createIdTokenVerifier)(n,r),s=await o.verifyJWT(e,i);return i.checkRevoked?A(s):s}function I(e,t){return n.createCustomToken(e,t)}async function b(t,r=T){let i=await w(t,{referer:r.referer}),n=(0,u.filterStandardClaims)(i);r.dynamicCustomClaimsKeys?.length&&r.dynamicCustomClaimsKeys.forEach(e=>{delete n[e]});let o=await I(i.uid,{...n,email_verified:i.email_verified,source_sign_in_provider:i.firebase.sign_in_provider});return(0,s.debug)("Generated custom token based on provided idToken",{customToken:o}),{...await m(o,e.apiKey,{tenantId:e.tenantId,appCheckToken:r.appCheckToken,referer:r.referer}),customToken:o}}async function _(e){return i.createNewAccount(e).then(e=>h(e)).then(e=>{if(!e)throw new d.AuthError(d.AuthErrorCode.INTERNAL_ERROR,"Could not get recently created user from database. Most likely it was deleted.");return e})}async function R(e,t){return i.updateExistingAccount(e,t).then(e=>h(e)).then(e=>{if(!e)throw new d.AuthError(d.AuthErrorCode.INTERNAL_ERROR,"Could not get recently updated user from database. Most likely it was deleted.");return e})}return{verifyAndRefreshExpiredIdToken:async function(t,r=T){return await E(async()=>{let e=await w(t.idToken,r);return{idToken:t.idToken,decodedIdToken:e,refreshToken:t.refreshToken,customToken:t.customToken}},async()=>{if(t.refreshToken){let i=await o(t.refreshToken,{referer:r.referer,enableCustomToken:e.enableCustomToken});return await r.onTokenRefresh?.(i),i}throw new d.InvalidTokenError(d.InvalidTokenReason.MISSING_REFRESH_TOKEN)},async e=>{if(e instanceof d.AuthError&&e.code===d.AuthErrorCode.NO_MATCHING_KID)throw d.InvalidTokenError.fromError(e,d.InvalidTokenReason.INVALID_KID);throw d.InvalidTokenError.fromError(e,d.InvalidTokenReason.INVALID_CREDENTIALS)},r.enableTokenRefreshOnExpiredKidHeader??!1)},verifyIdToken:w,createCustomToken:I,getCustomIdAndRefreshTokens:b,handleTokenRefresh:o,deleteUser:async function(e){await i.deleteAccount(e)},setCustomUserClaims:async function(e,t){await i.setCustomUserClaims(e,t)},getUser:h,getUserByEmail:async function(e){return i.getAccountInfoByEmail(e).then(e=>{if(!e.users||!e.users.length)throw new d.AuthError(d.AuthErrorCode.USER_NOT_FOUND);return new y.UserRecord(e.users[0])})},updateUser:R,createUser:_,createAnonymousUser:async function(e){return g(e)},listUsers:async function(e,t){return i.listUsers(e,t).then(e=>{let t={users:e.users.map(e=>new y.UserRecord(e))};return e.nextPageToken&&(t.nextPageToken=e.nextPageToken),t})},createSessionCookie:c}}},62067:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FirebaseTokenVerifier=void 0,t.createIdTokenVerifier=function(e,t){return new l(o.CLIENT_CERT_URL,"https://securetoken.google.com/",e,t)};let i=r(70463),n=r(7589),o=r(66728),s=r(60430),a=r(98822),u=r(35886),c=r(10993);class l{issuer;projectId;tenantId;signatureVerifier;constructor(e,t,r,i){if(this.issuer=t,this.projectId=r,this.tenantId=i,!(0,c.isURL)(e))throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,"The provided public client certificate URL is an invalid URL.");this.signatureVerifier=a.PublicKeySignatureVerifier.withCertificateUrl(e)}async verifyJWT(e,t){let r=await this.decodeAndVerify(e,this.projectId,t),i=(0,u.mapJwtPayloadToDecodedIdToken)(r.payload);if(this.tenantId&&i.firebase.tenant!==this.tenantId)throw new n.AuthError(n.AuthErrorCode.MISMATCHING_TENANT_ID);return i}async decodeAndVerify(e,t,r){let n=(0,i.decodeProtectedHeader)(e),o=(0,i.decodeJwt)(e);return this.verifyContent({header:n,payload:o},t),await this.verifySignature(e,r),{header:n,payload:o}}verifyContent(e,t){let r,i=e&&e.header,a=e&&e.payload;if((0,o.useEmulator)()||void 0!==i.kid?(0,o.useEmulator)()||i.alg===s.ALGORITHM_RS256?a.iss!==this.issuer+t?r=`idToken has incorrect "iss" (issuer) claim. Expected ${this.issuer}${t}, but got ${a.iss}`:""===a.sub?r='idToken has an empty string "sub" (subject) claim.':"string"==typeof a.sub&&a.sub.length>128&&(r='idToken has "sub" (subject) claim longer than 128 characters.'):r=`Incorrect algorithm. ${s.ALGORITHM_RS256} expected, ${i.alg} provided`:r=a.aud===o.FIREBASE_AUDIENCE?"idToken was expected, but custom token was provided":'idToken has no "kid" claim.',r)throw new n.AuthError(n.AuthErrorCode.INVALID_ARGUMENT,r)}verifySignature(e,t){return this.signatureVerifier.verify(e,t).catch(e=>{throw this.mapJoseErrorToAuthError(e)})}mapJoseErrorToAuthError(e){return e instanceof i.errors.JWTExpired?n.AuthError.fromError(e,n.AuthErrorCode.TOKEN_EXPIRED,e.message):e instanceof i.errors.JWSSignatureVerificationFailed?n.AuthError.fromError(e,n.AuthErrorCode.INVALID_SIGNATURE):e instanceof n.AuthError?e:n.AuthError.fromError(e,n.AuthErrorCode.INTERNAL_ERROR,e.message)}}t.FirebaseTokenVerifier=l},66728:(e,t,r)=>{var i=r(40074);function n(){if(void 0!==i)return i.env.FIREBASE_AUTH_EMULATOR_HOST}Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_CERT_URL=t.FIREBASE_AUDIENCE=void 0,t.emulatorHost=n,t.useEmulator=function(){return!!n()},t.FIREBASE_AUDIENCE="https://identitytoolkit.googleapis.com/google.identity.identitytoolkit.v1.IdentityToolkit",t.CLIENT_CERT_URL="https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com"},77740:(e,t,r)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UserRecord=t.UserInfo=t.UserMetadata=t.MultiFactorSettings=t.PhoneMultiFactorInfo=t.MultiFactorInfo=void 0;let n=r(35886),o=r(10993),s=r(70463),a=r(7589),u=s.base64url.encode("REDACTED");function c(e){try{let t=new Date(parseInt(e,10));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}return null}(i||(i={})).Phone="phone";class l{uid;displayName;factorId;enrollmentTime;static initMultiFactorInfo(e){let t=null;try{t=new d(e)}catch{return null}return t}constructor(e){this.initFromServerResponse(e)}toJSON(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}}initFromServerResponse(e){let t=e&&this.getFactorId(e);if(!t||!e||!e.mfaEnrollmentId)throw new a.AuthError(a.AuthErrorCode.INTERNAL_ERROR,"INTERNAL ASSERT FAILED: Invalid multi-factor info response");(0,n.addReadonlyGetter)(this,"uid",e.mfaEnrollmentId),(0,n.addReadonlyGetter)(this,"factorId",t),(0,n.addReadonlyGetter)(this,"displayName",e.displayName),e.enrolledAt?(0,n.addReadonlyGetter)(this,"enrollmentTime",new Date(e.enrolledAt).toUTCString()):(0,n.addReadonlyGetter)(this,"enrollmentTime",null)}}t.MultiFactorInfo=l;class d extends l{phoneNumber;constructor(e){super(e),(0,n.addReadonlyGetter)(this,"phoneNumber",e.phoneInfo)}toJSON(){return Object.assign(super.toJSON(),{phoneNumber:this.phoneNumber})}getFactorId(e){return e&&e.phoneInfo?i.Phone:null}}t.PhoneMultiFactorInfo=d;class h{enrolledFactors;constructor(e){let t=[];if((0,o.isNonNullObject)(e))e.mfaInfo&&e.mfaInfo.forEach(e=>{let r=l.initMultiFactorInfo(e);r&&t.push(r)});else throw new a.AuthError(a.AuthErrorCode.INTERNAL_ERROR,"INTERNAL ASSERT FAILED: Invalid multi-factor response");(0,n.addReadonlyGetter)(this,"enrolledFactors",Object.freeze(t))}toJSON(){return{enrolledFactors:this.enrolledFactors.map(e=>e.toJSON())}}}t.MultiFactorSettings=h;class f{creationTime;lastSignInTime;lastRefreshTime;constructor(e){(0,n.addReadonlyGetter)(this,"creationTime",c(e.createdAt)),(0,n.addReadonlyGetter)(this,"lastSignInTime",c(e.lastLoginAt));let t=e.lastRefreshAt?new Date(e.lastRefreshAt).toUTCString():null;(0,n.addReadonlyGetter)(this,"lastRefreshTime",t)}toJSON(){return{lastSignInTime:this.lastSignInTime,creationTime:this.creationTime,lastRefreshTime:this.lastRefreshTime}}}t.UserMetadata=f;class p{uid;displayName;email;photoURL;providerId;phoneNumber;constructor(e){if(!e.rawId||!e.providerId)throw new a.AuthError(a.AuthErrorCode.INTERNAL_ERROR,"INTERNAL ASSERT FAILED: Invalid user info response");(0,n.addReadonlyGetter)(this,"uid",e.rawId),(0,n.addReadonlyGetter)(this,"displayName",e.displayName),(0,n.addReadonlyGetter)(this,"email",e.email),(0,n.addReadonlyGetter)(this,"photoURL",e.photoUrl),(0,n.addReadonlyGetter)(this,"providerId",e.providerId),(0,n.addReadonlyGetter)(this,"phoneNumber",e.phoneNumber)}toJSON(){return{uid:this.uid,displayName:this.displayName,email:this.email,photoURL:this.photoURL,providerId:this.providerId,phoneNumber:this.phoneNumber}}}t.UserInfo=p;class y{uid;email;emailVerified;displayName;photoURL;phoneNumber;disabled;metadata;providerData;passwordHash;passwordSalt;customClaims;tenantId;tokensValidAfterTime;multiFactor;constructor(e){if(!e.localId)throw new a.AuthError(a.AuthErrorCode.INTERNAL_ERROR,"INTERNAL ASSERT FAILED: Invalid user response");(0,n.addReadonlyGetter)(this,"uid",e.localId),(0,n.addReadonlyGetter)(this,"email",e.email),(0,n.addReadonlyGetter)(this,"emailVerified",!!e.emailVerified),(0,n.addReadonlyGetter)(this,"displayName",e.displayName),(0,n.addReadonlyGetter)(this,"photoURL",e.photoUrl),(0,n.addReadonlyGetter)(this,"phoneNumber",e.phoneNumber),(0,n.addReadonlyGetter)(this,"disabled",e.disabled||!1),(0,n.addReadonlyGetter)(this,"metadata",new f(e));let t=[];for(let r of e.providerUserInfo||[])t.push(new p(r));(0,n.addReadonlyGetter)(this,"providerData",t),e.passwordHash===u?(0,n.addReadonlyGetter)(this,"passwordHash",void 0):(0,n.addReadonlyGetter)(this,"passwordHash",e.passwordHash),(0,n.addReadonlyGetter)(this,"passwordSalt",e.salt),e.customAttributes&&(0,n.addReadonlyGetter)(this,"customClaims",JSON.parse(e.customAttributes));let r=null;void 0!==e.validSince&&(r=c(1e3*parseInt(e.validSince,10))),(0,n.addReadonlyGetter)(this,"tokensValidAfterTime",r||void 0),(0,n.addReadonlyGetter)(this,"tenantId",e.tenantId);let i=new h(e);i.enrolledFactors.length>0&&(0,n.addReadonlyGetter)(this,"multiFactor",i)}toJSON(){let e={uid:this.uid,email:this.email,emailVerified:this.emailVerified,displayName:this.displayName,photoURL:this.photoURL,phoneNumber:this.phoneNumber,disabled:this.disabled,metadata:this.metadata.toJSON(),passwordHash:this.passwordHash,passwordSalt:this.passwordSalt,customClaims:(0,n.deepCopy)(this.customClaims),tokensValidAfterTime:this.tokensValidAfterTime,tenantId:this.tenantId};for(let t of(this.multiFactor&&(e.multiFactor=this.multiFactor.toJSON()),e.providerData=[],this.providerData))e.providerData.push(t.toJSON());return e}}t.UserRecord=y},92998:e=>{var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise(function(r,i){var n,o,s;function a(r){e.removeListener(t,u),i(r)}function u(){"function"==typeof e.removeListener&&e.removeListener("error",a),r([].slice.call(arguments))}y(e,t,u,{once:!0}),"error"!==t&&(n=e,o=a,s={once:!0},"function"==typeof n.on&&y(n,"error",o,s))})},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,r,i){if(a(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),(n=u(e))>0&&s.length>n&&!s.warned){s.warned=!0;var n,o,s,c=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,console&&console.warn&&console.warn(c)}return e}function l(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=l.bind(i);return n.listener=r,i.wrapFn=n,n}function h(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):p(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function y(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function n(o){i.once&&e.removeEventListener(t,n),r(o)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,o=this._events;if(void 0!==o)n=n&&void 0===o.error;else if(!n)return!1;if(n){if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var s,a=Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)i(u,this,t);else for(var c=u.length,l=p(u,c),r=0;r<c;++r)i(l[r],this,t);return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,i,n,o,s;if(a(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,n=o;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var n,o=Object.keys(r);for(i=0;i<o.length;++i)"removeListener"!==(n=o[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},98822:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PublicKeySignatureVerifier=t.JWKSSignatureVerifier=t.UrlKeyFetcher=void 0,t.fetchPublicKey=f;let i=r(70463),n=r(50318),o=r(7589),s=r(66728),a=r(60430),u=r(10993),c=new Map;class l{clientCertUrl;constructor(e){if(this.clientCertUrl=e,!(0,u.isURL)(e))throw Error("The provided public client certificate URL is not a valid URL.")}async fetchPublicKeysResponse(e){let t=await fetch(e),r={};if(t.headers.forEach((e,t)=>{r[t]=e}),(0,n.debug)("Public keys fetched",{responseHeaders:r,cryptoRuntime:i.cryptoRuntime}),!t.ok){let e="Error fetching public keys for Google certs: ",r=await t.json();throw r.error?(e+=`${r.error}`,r.error_description&&(e+=" ("+r.error_description+")")):e+=`${await t.text()}`,Error(e)}let o=await t.json();if(o.error)throw Error("Error fetching public keys for Google certs: "+o.error);return{keys:o,expiresAt:function(e){if(!e.headers.has("cache-control"))return 0;let t=e.headers.get("cache-control").split(",").reduce((e,t)=>{let r=t.trim().split("=");return"max-age"===r[0]?+r[1]:e},0);return Date.now()+1e3*t}(t)}}async fetchAndCachePublicKeys(e){(0,n.debug)("No public keys found in cache. Fetching public keys from Google...",{cryptoRuntime:i.cryptoRuntime});let t=await this.fetchPublicKeysResponse(e);return c.set(e.toString(),t),(0,n.debug)("Public keys cached",{cacheKey:e.toString(),expiresAt:t.expiresAt,cryptoRuntime:i.cryptoRuntime}),t.keys}async fetchPublicKeys(){let e=new URL(this.clientCertUrl),t=c.get(e.toString());if(!t)return this.fetchAndCachePublicKeys(e);let{keys:r,expiresAt:o}=t,s=Date.now();return((0,n.debug)("Get public keys from cache",{expiresAt:o,now:s,cryptoRuntime:i.cryptoRuntime}),o<=s)?this.fetchAndCachePublicKeys(e):r}}t.UrlKeyFetcher=l;class d{options;jwksUrl;constructor(e,t){if(this.options=t,!(0,u.isURL)(e))throw Error("The provided JWKS URL is not a valid URL.");this.jwksUrl=new URL(e)}async getPublicKey(e){return(0,i.createRemoteJWKSet)(this.jwksUrl,this.options)(e)}async verify(e,t){let r=(0,i.decodeProtectedHeader)(e);try{await (0,a.verify)(e,()=>this.getPublicKey(r),t)}catch(r){if(r instanceof i.errors.JWKSMultipleMatchingKeys){for await(let n of r)try{await (0,a.verify)(e,()=>Promise.resolve(n),t);return}catch(e){if(e instanceof i.errors.JWSSignatureVerificationFailed)continue;throw e}throw new i.errors.JWSSignatureVerificationFailed}throw r}}}t.JWKSSignatureVerifier=d;class h{keyFetcher;constructor(e){if(this.keyFetcher=e,!(0,u.isNonNullObject)(e))throw Error("The provided key fetcher is not an object or null.")}static withCertificateUrl(e){return new h(new l(e))}async getPublicKey(e){return(0,s.useEmulator)()?{type:"none"}:f(this.keyFetcher,e).then(a.getPublicCryptoKey)}async verify(e,t){let r=(0,i.decodeProtectedHeader)(e);try{await (0,a.verify)(e,()=>this.getPublicKey(r),t)}catch(r){if(r instanceof o.AuthError&&r.code===o.AuthErrorCode.NO_KID_IN_HEADER)return void await this.verifyWithoutKid(e,t);throw r}}async verifyWithoutKid(e,t){let r=await this.keyFetcher.fetchPublicKeys();return this.verifyWithAllKeys(e,r,t)}async verifyWithAllKeys(e,t,r){let n=[];return Object.values(t).forEach(t=>{let o=(0,a.verify)(e,async()=>(0,a.getPublicCryptoKey)(t),r).then(()=>!0).catch(e=>{if(e instanceof i.errors.JWTExpired)throw e;return!1});n.push(o)}),Promise.all(n).then(e=>{if(e.every(e=>!1===e))throw new o.AuthError(o.AuthErrorCode.INVALID_SIGNATURE)})}}async function f(e,t){if(!t.kid)throw new o.AuthError(o.AuthErrorCode.NO_KID_IN_HEADER);let r=t.kid,i=await e.fetchPublicKeys();if(!Object.prototype.hasOwnProperty.call(i,r))throw new o.AuthError(o.AuthErrorCode.NO_MATCHING_KID);return i[r]}t.PublicKeySignatureVerifier=h}}]);